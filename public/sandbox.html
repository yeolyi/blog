<!doctype html>
<html>
  <head>
    <script type="module">
      import stringifyObject from 'https://cdn.jsdelivr.net/npm/stringify-object@5.0.0/+esm';

      const INDENT = '  ';
      const SECRET = '[secret ðŸ˜œ]';

      const exec = (code, logger) => {
        console.log = logger;
        // js ì˜ˆì œ ì½”ë“œ ì¤‘ ì „ì—­ì—ì„œ ë™ìž‘í•´ì•¼í•˜ëŠ” ê²ƒì´ ìžˆì–´
        // Functionì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
        (0, eval)(code);
      };

      const toString = (x, excluded) => {
        if (excluded.includes(x)) return SECRET;
        // ë‘ ë²ˆ stringifyí•˜ëŠ” ê²ƒ ë°©ì§€(ìŠ¬ëž˜ì‹œê°€ ë‘ ë²ˆ ë‚˜ì˜¤ëŠ” ë¬¸ì œ)
        if (typeof x === 'string') return `'${x}'`;

        if (x instanceof Number) return `[Number: ${x}]`;
        if (x instanceof Boolean) return `[Boolean: ${x}]`;

        return stringifyObject(x, {
          INDENT,
          inlineCharacterLimit: 80,
          transform: (obj, property, originalResult) => {
            if (excluded.includes(obj[property])) return SECRET;
            return originalResult;
          },
        });
      };

      const messageHandler = (e) => {
        const postMessage = (data) => e.source.postMessage(data, '*');

        const logger = (...data) => {
          logger.toString = () => SECRET;
          logger.valueOf = () => SECRET;

          postMessage({
            type: 'log',
            data: data.map((datum) => toString(datum, [logger])).join(', '),
          });
        };

        try {
          exec(e.data, logger);
        } catch (e) {
          postMessage({ type: 'exception', data: e.message });
        }
      };

      window.addEventListener('message', messageHandler);
    </script>
  </head>
</html>
