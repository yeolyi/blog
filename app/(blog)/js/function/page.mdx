import ImageViewer from '@/components/common/ImageViewer';
import pythonArg from '@/public/python_default_arg.png';

export let metadata = {
  title: 'ìë°”ìŠ¤í¬ë¦½íŠ¸ ê³µë¶€ ê¸°ë¡ - í•¨ìˆ˜',
  description:
    'ë§¥ë½ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ í•¨ìˆ˜ì™€ this í‚¤ì›Œë“œë¥¼ ê³µë¶€í–ˆìŠµë‹ˆë‹¤.',
};

# Functions

í˜¸ì¶œëœ í•¨ìˆ˜ëŠ” ì „ë‹¬ë°›ì€ ì¸ì ì™¸ì—ë„ **invocation context**ë¼ëŠ” ê°’ì„ ë³„ë„ë¡œ ê°€ì§€ê³ 
`this` í‚¤ì›Œë“œë¡œ ì°¸ì¡°í•  ìˆ˜ ìˆì–´ìš”. í•¨ìˆ˜ê°€ ê°ì²´ë¥¼ í†µí•´(ê°ì²´ì˜ ë©”ì„œë“œë¡œì„œ) í˜¸ì¶œë˜ë©´
í•´ë‹¹ ê°ì²´ê°€ invocation contextê°€ ë©ë‹ˆë‹¤.

## Defining Functions

í•¨ìˆ˜ ì„ ì–¸ë¬¸ì€ í˜¸ì´ìŠ¤íŒ…ë©ë‹ˆë‹¤:

```js
f();
function f() {
  console.log('f');
}
```

í•¨ìˆ˜ í‘œí˜„ì‹ì€ í˜¸ì´ìŠ¤íŒ…ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤:

```js
f();
let f = function () {
  console.log('f');
};
```

í™”ì‚´í‘œ í•¨ìˆ˜ëŠ” `prototype` í”„ë¡œí¼í‹°ë¥¼ ê°€ì§€ì§€ ì•Šì•„ í´ë˜ìŠ¤ ìƒì„±ìë¡œ ì‚¬ìš©ë  ìˆ˜
ì—†ìŠµë‹ˆë‹¤.

```js
let f = function () {};
let g = () => {};

console.log('prototype' in f);
console.log('prototype' in g);

new g();
```

ì¼ë°˜ í•¨ìˆ˜ëŠ” í˜¸ì¶œ ë°©ë²•ì— ë”°ë¼ `this`ì˜ ê°’ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤:

```js
let obj = {
  x: 123,
  f: function () {
    return this.x;
  },
};

console.log(obj.f());

let g = obj.f;
console.log(g());
```

í™”ì‚´í‘œí•¨ìˆ˜ëŠ” ì •ì˜ëœ í™˜ê²½ì˜ this ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤:

```js
let obj1 = {
  x: 123,
  // í™”ì‚´í‘œ í•¨ìˆ˜ê°€ ë§Œë“¤ì–´ì§ˆ ë•Œ thisì˜ ê°’ì€ ì „ì—­ ê°ì²´ì…ë‹ˆë‹¤
  f: () => this.x,
};

console.log(obj1.f());

class A {
  x = 123;
  // í™”ì‚´í‘œ í•¨ìˆ˜ëŠ” Aì˜ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œì ì— ë§Œë“¤ì–´ì§€ê³ 
  // ì´ë•Œ thisì˜ ê°’ì€ ìƒì„±ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ì…ë‹ˆë‹¤.
  g = () => this.x;
}

let obj2 = new A();
console.log(obj2.g());

// í™”ì‚´í‘œ í•¨ìˆ˜ë¥¼ ëœ¯ì–´ë‚´ ì‹¤í–‰í•´ë„ thisì˜ ê°’ì€ ìœ ì§€ë©ë‹ˆë‹¤.
let g = obj2.g;
console.log(g());
```

í™”ì‚´í‘œ í•¨ìˆ˜ê°€ ê°ì²´ ë‚´ë¶€ì— ìˆì„ë–„ì™€ í´ë˜ìŠ¤ ë‚´ë¶€ì— ìˆì„ ë•Œ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ëŠ” ì´ìœ ëŠ”
ì•„ë˜ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

> Because a class's body has a this context, arrow functions as class fields
> close over the class's this context, and the this inside the arrow function's
> body will correctly point to the instance (or the class itself, for static
> fields). However, because it is a **closure, not the function's own binding**,
> the value of this will not change based on the execution context.
>
> https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions

## Invoking Functions

í•¨ìˆ˜ëŠ” ë‹¤ìŒ ë°©ë²•ë“¤ë¡œ í˜¸ì¶œë  ìˆ˜ ìˆì–´ìš”:

- í•¨ìˆ˜ë¡œì„œ
- ë©”ì„œë“œë¡œì„œ
- ìƒì„±ìë¡œì„œ
- callì´ë‚˜ apply ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ê°„ì ‘ì ìœ¼ë¡œì„œ
- JSì— ì˜í•´ ì•”ë¬µì ìœ¼ë¡œì„œ
  - get/set
  - toString, valueOf
  - iteration ê´€ë ¨ í•¨ìˆ˜ë“¤
  - tagged template literal,
  - Proxyë“±...

thisì— í•´ë‹¹í•˜ëŠ” ê°ì²´ê°€ ì—†ì„ ë•Œ strict modeë©´ undefined, ì•„ë‹ˆë©´ ì „ì—­ ê°ì²´ê°€ ë¼ìš”:

```js
// âœï¸ ì£¼ì„ì„ í•´ì œí•´ë³´ì„¸ìš”
// 'use strict'
const isStrict = (function () {
  return !this;
})();

console.log(isStrict);
```

í•¨ìˆ˜ê°€ thisë¥¼ ë°˜í™˜í•˜ë„ë¡í•˜ë©´ **method chaining** ìŠ¤íƒ€ì¼ì˜ APIë¥¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”:

```js
class Square {
  x(val) {
    this.x = val;
    return this;
  }
  y(val) {
    this.y = val;
    return this;
  }
  outline(color) {
    this.outline = color;
    return this;
  }
  toString() {
    return `Square\n - x: ${this.x}\n - y: ${this.y}\n - outline: ${this.outline}`;
  }
}

console.log(String(new Square().x(100).y(100).outline('red')));
```

í•¨ìˆ˜ í˜¸ì¶œ ë°©ë²•ì— ë”°ë¼ ë‹¬ë¼ì§€ëŠ” `this`ì˜ íŠ¹ì§•ìœ¼ë¡œ ì¸í•´ ì¤‘ì²© í•¨ìˆ˜ì˜ thisëŠ” ì™¸ë¶€
ìŠ¤ì½”í”„ì˜ thisê°’ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆì–´ìš”. ì±… ë§ë¡œëŠ” JSì˜ ê²°í•¨ìœ¼ë¡œ ì—¬ê²¨ì§„ë‹¤ê³  í•˜ë„¤ìš”:

```js
let o = {
  m: function () {
    console.log(this.toString());

    function f() {
      console.log(this.toString());
    }

    f();
  },
  toString() {
    return '[object O]';
  },
};

o.m();
```

ìœ„ ê°™ì€ ë¬¸ì œëŠ” selfì™€ ê°™ì€ ë³„ë„ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•´ ì“°ê³ ìí•˜ëŠ” `this`ë¥¼ ë³€ìˆ˜ë¡œ
ì¡ì•„ë‘ê±°ë‚˜, bind ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, í™”ì‚´í‘œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

new í‚¤ì›Œë“œë¥¼ ë¶™ì´ë©´ íƒ€ê²Ÿ í•¨ìˆ˜ëŠ” <strong>ìƒì„±ì(constructor)</strong>ë¡œ ê¸°ëŠ¥í•˜ê³ 
ì¼ë°˜ í•¨ìˆ˜ í˜¸ì¶œê³¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬ë¼ìš”.

- ìƒì„±ìì˜ `prototype` í”„ë¡œí¼í‹°ë¥¼ ìƒì†ë°›ëŠ” ê°ì²´ê°€ ìƒì„±ë˜ê³  í•¨ìˆ˜ ë³¸ë¬¸ì˜ `this`ê°€
  ì´ ê°ì²´ë¥¼ ê°€ë¥´í‚µë‹ˆë‹¤.
- í•¨ìˆ˜ ë³¸ë¬¸ì˜ returnì—ì„œ ê°ì²´ë¥¼ ë°˜í™˜í•˜ë©´ ê·¸ ê°ì²´ê°€ ë°˜í™˜ë˜ê³ , ê°ì²´ê°€ ì•„ë‹Œê±¸
  ë°˜í™˜í•˜ë©´ í•´ë‹¹ returnë¬¸ì€ ë¬´ì‹œë©ë‹ˆë‹¤.

## Function Arguments and Parameters

```js
function foo(a = []) {
  console.log(a);
  a.push(1);
}

foo();
foo();
foo();
```

í•¨ìˆ˜ ì¸ì ê¸°ë³¸ê°’ì€ í˜¸ì¶œë§ˆë‹¤ ì´ˆê¸°í™”ë˜ê³  ì´ëŠ” íŒŒì´ì¬ê³¼ì˜ ì°¨ì´ì ì´ì—ìš”.

<ImageViewer
  src={pythonArg}
  alt="íŒŒì´ì¬ ì¸ì íŠ¹"
  widthPercentage="50%"
  priority
  href="https://twitter.com/holdenmatt/status/1774866242282672365"
/>

ê¸°ë³¸ê°’ì´ ìƒìˆ˜ì¼ í•„ìš”ëŠ” ì—†ê³  ë‹¤ë¥¸ ì¸ìê°’ì— ì˜ì¡´ì ì¸ ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤:

```js
let rec = (width, height = width) => ({ width, height });
console.log(rec(1));
```

Rest parameter í•¨ìˆ˜ ì¸ì ì˜ˆì œ:

```js
function multiply(multiplier, ...theArgs) {
  return theArgs.map((element) => {
    return multiplier * element;
  });
}

console.log(multiply(2, 15, 25, 42));
```

í•¨ìˆ˜ ë§¤ê°œë³€ìˆ˜ì—ì„œë„ destructuringì´ ì•„ë˜ì™€ ê°™ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:

```js
function vectorAdd([x1, y1], [x2, y2]) {
  return [x1 + x2, y1 + y2];
}

console.log(vectorAdd([1, 2], [3, 4]));

let vectorMultiply = ({ x, y, z = 0 }, scalar) => ({
  x: x * scalar,
  y: y * scalar,
  z: z * scalar,
});

console.log(vectorMultiply({ x: 1, y: 2 }, 10));
```

## Functions as Values

í•¨ìˆ˜ë„ ê°ì²´ì´ë¯€ë¡œ í”„ë¡œí¼í‹°ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆì–´ìš”:

```js
let fibo = (n) => {
  if (fibo.n) return fibo.n;
  if (n <= 2) return 1;
  return (fibo.n = fibo(n - 1) + fibo(n - 2));
};

console.log(fibo(100));
```

## Functions as Namespaces

> ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ í‘œí˜„(IIFE, Immediately Invoked Function Expression)ì€
> ì •ì˜ë˜ìë§ˆì ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” Javascript Function ë¥¼ ë§í•œë‹¤.
>
> https://developer.mozilla.org/ko/docs/Glossary/IIFE

IIFEë¥¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
(function () {
  let val = 10;
  console.log('IIFE');
  // ë³€ìˆ˜ valë¡œ ì´ê²ƒì €ê²ƒ í•˜ê¸°
})();

// IIFE ë‚´ë¶€ì˜ ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
console.log(val);
```

## Closures

> ë ‰ì‹œì»¬ ìŠ¤ì½”í”„ ê·œì¹™ì„ ë”°ë¥´ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ í•¨ìˆ˜ëŠ” í˜¸ì¶œ ìŠ¤íƒê³¼ ê´€ê³„ì—†ì´ ê°ê°ì˜
> (thisë¥¼ ì œì™¸í•œ) ëŒ€ì‘í‘œë¥¼ ì†ŒìŠ¤ì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ ì •ì˜í•˜ê³ , ëŸ°íƒ€ì„ì— ê·¸ ëŒ€ì‘í‘œë¥¼
> ë³€ê²½ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤.
>
> í´ë¡œì € = í•¨ìˆ˜ + í•¨ìˆ˜ë¥¼ ë‘˜ëŸ¬ì‹¼ í™˜ê²½(lexical environment)
>
> https://ui.toast.com/weekly-pick/ko_20160311

```js
let scope = 'global scope';

function createClosure() {
  let scope = 'local scope';
  return () => scope;
}

let closure = createClosure();
console.log(closure());
```

ì—¬ëŸ¬ í•¨ìˆ˜ê°€ ê°™ì€ í™˜ê²½ì„ ê³µìœ í•  ìˆ˜ ìˆì–´ìš”:

```js
let createCounter = (n) => {
  return {
    // í•¨ìˆ˜ ì¸ìë„ í´ë¡œì €ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.
    // countì™€ resetì€ ê°™ì€ í™˜ê²½ì„ ê³µìœ í•©ë‹ˆë‹¤.
    count: () => n++,
    reset: () => (n = 0),
  };
};

let c1 = createCounter(1);
let c2 = createCounter(10);

console.log(c1.count(), c2.count());
console.log(c1.count(), c2.count());
c2.reset();
console.log(c1.count(), c2.count());
```

varì™€ í´ë¡œì €ì˜ ì¡°í•©ìœ¼ë¡œ ë²„ê·¸ê°€ ìƒê¸´ ì½”ë“œ:

```js
// ëª©í‘œ: 0-9ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì˜ ë°°ì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
const foo = () => {
  let funcs = [];

  // iê°€ í´ë¡œì €ë“¤ê°„ì— ê³µìœ ë©ë‹ˆë‹¤.
  // âœï¸ var -> let ìœ¼ë¡œ ë°”ê¿”ë³´ì„¸ìš”
  for (var i = 0; i < 10; i++) {
    funcs[i] = () => i;
  }

  return funcs;
};

let a = foo();
console.log(a[5]());
```

ìƒìœ„ í•¨ìˆ˜ì˜ `this`ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¡œì €ê°€ í•„ìš”í•˜ë‹¤ë©´ ì•„ë˜ ë°©ë²•ë“¤ ì¤‘ í•˜ë‚˜ë¥¼
í™œìš©í•©ë‹ˆë‹¤:

```js
let obj = {
  x: 123,
  f() {
    // âš ï¸ ì¼ë°˜ í•¨ìˆ˜ëŠ” ë°”ê¹¥ ìŠ¤ì½”í”„ì˜ thisë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    let g1 = function () {
      return this;
    };

    // âœ… ë”°ë¼ì„œ í™”ì‚´í‘œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜,
    let g2 = () => this;

    // âœ… bindë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜,
    let g3 = g1.bind(this);

    // âœ… thisë¥¼ í´ë¡œì € ë‚´ë¶€ì˜ ë³„ë„ ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤.
    let self = this;
    let g4 = function () {
      return self;
    };

    // âœï¸ ë‹¤ë¥¸ g í•¨ìˆ˜ë“¤ì„ ëŒ€ì‹  ë°˜í™˜í•´ë³´ì„¸ìš”
    return g1;
  },

  toString() {
    return '[object obj]';
  },
};

console.log(String(obj.f()()));
```

## Function Properties, Methods, and Constructor

```js
let sum2 = (a, b) => a + b;
let sum3 = (a, b, c) => a + b + c;
let sum = (...args) => args.reduce((prev, cur) => prev + cur, 0);

console.log(sum2.length, sum3.length, sum.length);
console.log(sum2.name);
```

ëª¨ë“  í•¨ìˆ˜ëŠ” ì„œë¡œ ë‹¤ë¥¸ í”„ë¡œí† íƒ€ì… ê°ì²´ë¥¼ ê°€ì§‘ë‹ˆë‹¤. í•¨ìˆ˜ê°€ ìƒì„±ìë¡œì„œ í˜¸ì¶œë˜ë©´
ìƒˆë¡œ ìƒê¸´ ê°ì²´ëŠ” ì´ í”„ë¡œí† íƒ€ì… ê°ì²´ë¥¼ ìƒì†ë°›ìŠµë‹ˆë‹¤:

```js
function f() {}
function g() {}
console.log(f.prototype === g.prototype);

let a = new f();
console.log(Object.getPrototypeOf(a) === f.prototype);
```

`call`ê³¼ `apply` ë©”ì„œë“œëŠ” í•¨ìˆ˜ê°€ ë‹¤ë¥¸ ê°ì²´ì˜ ë©”ì„œë“œì¸ ê²ƒì²˜ëŸ¼ ë™ì‘í•˜ê²Œ í•´ìš”:

```js
function f() {
  console.log(this);
}

let o = { x: 123 };

f();
f.call(o, 1, 2);
f.apply(o, [1, 2]);
```

`bind`ëŠ” í•¨ìˆ˜ ë‚´ this í‚¤ì›Œë“œì— í•´ë‹¹í•˜ëŠ” ê°ì²´ë¥¼ ì§€ì •í•  ìˆ˜ ìˆì–´ìš”:

```js
function f() {
  console.log(this.x);
}

let obj1 = { x: 123 };
let obj2 = { x: 456 };

let boundf1 = f.bind(obj1);
// âš ï¸ í•œ ë²ˆ bindëœ í•¨ìˆ˜ëŠ” override í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
let boundf2 = f.bind(obj1).bind(obj2);
boundf1();
boundf2();
```

ì¸ì ì¼ë¶€ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```js
// ì¸ì ì¼ë¶€ë¥¼ ë¯¸ë¦¬ ì œê³µí•˜ê¸°
let sum = (x, y) => x + y;
let inc = sum.bind(null, 1);
console.log(inc(10));

// í•¨ìˆ˜ ì´ë¦„ë„ ë°”ë€Œì–´ìš”
console.log(inc.name);
console.log(inc.bind().bind().bind().bind().name);
```

Function ìƒì„±ìë¡œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ ìˆ˜ ìˆê³  ì „ì—­ í•¨ìˆ˜ì¸ ê²ƒì²˜ëŸ¼ ë™ì‘í•©ë‹ˆë‹¤:

```js
let sum = new Function('x', 'y', 'return x+y');
console.log(sum(1, 2));
```

## Functional Programming

**ê³ ì°¨ í•¨ìˆ˜**(Higher order function)ëŠ” í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê±°ë‚˜ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ”
í•¨ìˆ˜ì…ë‹ˆë‹¤:

```js
// ê³ ì°¨í•¨ìˆ˜ ì˜ˆì‹œ
function not(f) {
  return function (...args) {
    // âœï¸ ì•„ë˜ ì½”ë“œë¡œ ë°”ê¾¸ê³  ì™œ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ”ì§€ ìƒê°í•´ë³´ì„¸ìš”.
    // âš ï¸ return !f(args)
    return !f.apply(this, args);
  };
}

Array.prototype.isEmpty = function () {
  return this.length === 0;
};

Array.prototype.notEmpty = not(Array.prototype.isEmpty);

console.log([].isEmpty(), [].notEmpty());
console.log([1].isEmpty(), [1].notEmpty());
```

í•©ì„±í•¨ìˆ˜ ì˜ˆì œ:

```js
function compose(f, g) {
  return function (...args) {
    // ğŸ¤” ì™œ í•˜ë‚˜ëŠ” callì´ê³  í•˜ë‚˜ëŠ” applyì¸ì§€ ê³ ë¯¼í•´ë³´ì„¸ìš”
    return f.call(this, g.apply(this, args));
  };
}

const sum = (x, y) => x + y;
const square = (x) => x * x;
console.log(compose(square, sum)(2, 3));
```

## ì½ì–´ë³¼ë§Œí•œ ê²ƒë“¤

JSì˜ `this`ë¥¼ ê³µë¶€í•˜ë‹¤ê°€ íŒŒì´ì¬ì˜ `self`ê°€ ë– ì˜¬ëì–´ìš”:

https://stackoverflow.com/questions/2709821/what-is-the-purpose-of-the-self-parameter-why-is-it-needed

```js
asyncFunc1((err, data) => {
  asyncFunc2((err, data) => {
    asyncFunc3((err, data) => {
      asyncFunc4((err, data) => {
        asyncFunc5((err, data) => {
          //
        });
      });
    });
  });
});
```
