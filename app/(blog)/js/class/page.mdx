## 9. Classes

ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” í”„ë¡œí† íƒ€ì… ê¸°ë°˜ ìƒì†ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 1. Classes and Prototypes

range ê°ì²´ë¥¼ ìƒì„±í•´ ë°˜í™˜í•˜ëŠ” íŒ©í† ë¦¬ í•¨ìˆ˜ ì˜ˆì œì…ë‹ˆë‹¤. í”„ë¡œí† íƒ€ì…ì„ ì—°ê²°í•˜ëŠ”
ê³¼ì •ì´ ëª…ì‹œì ìœ¼ë¡œ ë“œëŸ¬ë‚˜ìš”:

```js
function createRange(from, to) {
  // í”„ë¡œí† íƒ€ì… ê°ì²´ë¥¼ ì¸ìë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
  let r = Object.create(createRange.methods);
  r.from = from;
  r.to = to;
  return r;
}

// í”„ë¡œí† íƒ€ì… ê°ì²´ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
createRange.methods = {
  includes(x) {
    return this.from <= x && x < this.to;
  },
};

let r = createRange(1, 4);
console.log(r.includes(2), r.includes(5));
```

### 2. Classes and Constructors

`new` í‚¤ì›Œë“œë¡œ ê°ì²´ì˜ ìƒì„±ê³¼ í”„ë¡œí† íƒ€ì… ì—°ê²°ì„ ìë™í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```js
function Range(from, to) {
  if (!new.target) throw new Error('ì¼ë°˜ í•¨ìˆ˜ë¡œ í˜¸ì¶œë˜ì—ˆì–´ìš”');
  this.from = from;
  this.to = to;
}

Range.prototype = {
  includes(x) {
    return this.from <= x && x < this.to;
  },
};

// âœï¸ newë¥¼ ì§€ì›Œë³´ì„¸ìš”
let r = new Range(1, 4);
console.log(r.includes(2), r.includes(5));
```

ì„œë¡œ ë‹¤ë¥¸ ìƒì„±ì í•¨ìˆ˜ë¥¼ ì‚¬ìš©í–ˆì–´ë„ ë‘ ìƒì„±ì í•¨ìˆ˜ê°€ ê°™ì€ `prototype` í”„ë¡œí¼í‹°ë¥¼
ê°€ì§„ë‹¤ë©´ ê°™ì€ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì·¨ê¸‰ë©ë‹ˆë‹¤. ë‹¤ë¥´ê²Œ ë§í•˜ë©´ ê°ì²´ê°€ ì •í™•íˆ ì–´ë–¤
ìƒì„±ìë¥¼ ì‚¬ìš©í•´ ë§Œë“¤ì—ˆëŠ”ì§€ `instanceOf`ë¡œëŠ” ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:

```js
function A() {}
function B() {}
A.prototype = B.prototype = {};

let a = new A();
let b = new B();
console.log(a instanceof A, a instanceof B);
console.log(b instanceof A, b instanceof B);

// ì´ëŸ° í•¨ìˆ˜ë„ ìˆë„¤ìš”.
// createRange ì˜ˆì œì²˜ëŸ¼ ìƒì„±ì í•¨ìˆ˜ê°€ ì—†ëŠ” ê²½ìš°ëŠ”
// ì•„ë˜ ë°©ë²•ìœ¼ë¡œ í”„ë¡œí† íƒ€ì…ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
console.log(A.prototype.isPrototypeOf(a));
```

ì •í™•í•œ ìƒì„±ìê°€ ê¶ê¸ˆí•˜ë‹¤ë©´ `constructor` í”„ë¡œí¼í‹°ë¥¼ í™œìš©í•  ìˆ˜ ìˆì–´ìš”:

```js
function A() {}
let a = new A();

console.log(A === A.prototype.constructor);
console.log(A === a.constructor);
```

ë”°ë¼ì„œ í”„ë¡œí† íƒ€ì… ê°ì²´ë¥¼ ì§ì ‘ ë§Œë“¤ì—ˆë‹¤ë©´ `constructor` í”„ë¡œí¼í‹°ë¥¼ ì˜
ì„¤ì •í•´ì¤˜ì•¼í•©ë‹ˆë‹¤:

```js
function A() {}

// ë°©ë²• 1
A.prototype = {
  constructor: A,
  foo() {
    console.log('foo');
  },
};

function B() {}

// ë°©ë²• 2
B.prototype.foo = function () {
  console.log('foo');
};

console.log(new A().constructor === A, new B().constructor === B);
```

### 3. Classes with the class keyword

ES6ì— ì¶”ê°€ëœ `class` ë¬¸ë²•ìœ¼ë¡œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤:

```js
class Range {
  constructor(from, to) {
    this.from = from;
    this.to = to;
  }

  includes(x) {
    return this.from <= x && x < this.to;
  }
}
let r = new Range(1, 4);
console.log(r.includes(2), r.includes(5));
```

í´ë˜ìŠ¤ì˜ ë³¸ë¬¸ì€ ìë™ìœ¼ë¡œ strict modeê°€ ì ìš©ë˜ë©°, í´ë˜ìŠ¤ ì„ ì–¸ì€ í•¨ìˆ˜ ì„ ì–¸ê³¼
ë‹¤ë¥´ê²Œ í˜¸ì´ìŠ¤íŒ…ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

static ë©”ì„œë“œëŠ” í”„ë¡œí† íƒ€ì… ê°ì²´ê°€ ì•„ë‹Œ í•¨ìˆ˜ ìì²´ì— ì¶”ê°€ë©ë‹ˆë‹¤.

```js
class A {
  static foo() {
    console.log('foo');
  }
}

console.log('foo' in A, 'foo' in A.prototype);
```

ë¹„êµì  ìµœê·¼ì— ë©”ì„œë“œê°€ ì•„ë‹Œ í”„ë¡œí¼í‹°ë„ í´ë˜ìŠ¤ ë³¸ë¬¸ì—ì„œ ì´ˆê¸°í™”í•  ìˆ˜ ìˆê²Œ
ë˜ì—ˆìŠµë‹ˆë‹¤:

```js
class Buffer {
  static val = 10;

  // private instance field
  // (protected ì ‘ê·¼ì œì–´ìëŠ” JSì— ë”°ë¡œ ì—†ìŠµë‹ˆë‹¤)
  #size = 0;

  // âœï¸ ì•„ë˜ ë‘ ì¤„ì˜ ìˆœì„œë¥¼ ë°”ê¿”ë³´ì„¸ìš”
  // ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ” ì´ìœ ëŠ” ë’¤ì— ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ìˆœì„œë¥¼ ë‹¤ë£° ë•Œ ì„¤ëª…í• ê²Œìš”
  capacity = 4096;
  buffer = new Uint8Array(this.capacity);

  constructor() {
    console.log(this.buffer.length);
  }
}

console.log(Buffer.val);
new Buffer();
```

### 4. Adding Methods to Existing Classes

í”„ë¡œí† íƒ€ì… ê°ì²´ë¥¼ ìˆ˜ì •í•´ í´ë˜ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
// âœï¸ í™”ì‚´í‘œ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê³  ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”
Number.prototype.tree = function () {
  let n = this.valueOf();
  for (let i = 1; i <= n; i++) console.log('*'.repeat(i));
};

(3).tree();
```

ë‹¤ë§Œ ìœ„ ì˜ˆì œì²˜ëŸ¼ ë¹ŒíŠ¸ì¸ ê°ì²´ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì€ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ì˜, í˜¹ì€ JS
ë²„ì „ê°„ì˜ ì¶©ëŒì´ ìˆì„ ìˆ˜ ìˆì–´ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤.

### 5. Subclasses

ES6 ì´ì „ ë°©ì‹:

```js
function Range(from, to) {
  this.from = from;
  this.to = to;
}

Range.prototype = {
  includes(x) {
    return this.from <= x && x < this.to;
  },
  constructor: Range,
};

function Span(start, span) {
  // ë¶€ëª¨ í´ë˜ìŠ¤ì˜ êµ¬í˜„ì— í˜¸í™˜ë˜ë„ë¡ ìì‹ í´ë˜ìŠ¤ì—ì„œë„ ì´ˆê¸°í™”ë¥¼ í•´ì•¼í•©ë‹ˆë‹¤.
  // ES6 ì „ê¹Œì§€ëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë‚˜ ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ë²•(super)ì„ ì œê³µí•˜ì§€ ì•Šê¸°ì—
  // ë¶€ëª¨ í´ë˜ìŠ¤ì˜ êµ¬í˜„ì„ ì •í™•íˆ ì•Œì•„ì•¼í•©ë‹ˆë‹¤.
  this.from = start;
  this.to = start + span;
}

// â­ ì•„ë˜ ì¤„ì„ ì´í•´í•´ë³´ì„¸ìš”
Span.prototype = Object.create(Range.prototype);
Span.prototype.constructor = Span;

console.log(new Span(5, 5).includes(8));
```

`extends`ì™€ `super`ë¥¼ ì‚¬ìš©í•´ ì„œë¸Œí´ë˜ìŠ¤ ë§Œë“¤ê¸°:

```js
class Range {
  constructor(from, to) {
    this.from = from;
    this.to = to;
  }
  includes(x) {
    return this.from <= x && x < this.to;
  }
}

class Span extends Range {
  constructor(start, span) {
    super(start, start + span);
  }
}

console.log(new Span(5, 5).includes(8));
```

ì—¬ë‹´ìœ¼ë¡œ í´ë˜ìŠ¤ í‘œí˜„ì‹ì„ ì‚¬ìš©í•´ ì•„ë˜ì™€ ê°™ì€ í‘œê¸°ë„ ê°€ëŠ¥í•˜ê¸´ ê°€ëŠ¥í•©ë‹ˆë‹¤:

```js
class Span extends class {
  constructor(from, to) {
    this.from = from;
    this.to = to;
  }
  includes(x) {
    return this.from <= x && x < this.to;
  }
} {
  constructor(start, span) {
    super(start, start + span);
  }
}

console.log(new Span(5, 5).includes(8));
```

`extends`ë¥¼ ì‚¬ìš©í•˜ë©´ static ë©”ì„œë“œë„ ì•Œì•„ì„œ ìƒì†ë©ë‹ˆë‹¤. ì´ëŸ° ê¸°ëŠ¥ì€ ES6 ì´ì „ì—ëŠ”
ë¶ˆê°€ëŠ¥í–ˆì–´ìš”:

```js
class A {
  static foo() {}
}

class B extends A {}

console.log(A.foo === B.foo);
```

ê°‘ìê¸° ìƒê°ë‚œ ì˜ˆì œ:

```js
class A {
  static toString() {
    return 'class';
  }
  toString() {
    return 'instance';
  }
}

console.log(String(A));
console.log(String(new A()));
```

ì±…ì—ëŠ” ì—†ì—ˆì§€ë§Œ í´ë˜ìŠ¤ ì„ ì–¸ê³¼ ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒì„± ê³¼ì •ì´ ê¶ê¸ˆí•´ì„œ ì°¾ì•„ë´¤ì–´ìš”. ìš°ì„ 
í´ë˜ìŠ¤ ì„ ì–¸ë¬¸ì˜ í‰ê°€ ìˆœì„œì…ë‹ˆë‹¤:

```js
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes#evaluation_order

// 1ï¸âƒ£ extendsê°€ ìˆë‹¤ë©´ ìƒì„±ì í•¨ìˆ˜ê°€ ë§ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤
// âœï¸ ì£¼ì„ì„ í•´ì œí•˜ê³  ì–´ë–¤ ì—ëŸ¬ê°€ ëœ¨ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”
class A /* extends 1 */ {
  // 2ï¸âƒ£ constructor ë©”ì„œë“œë¥¼ extract(?)í•˜ê³  ì—†ë‹¤ë©´ ê¸°ë³¸ êµ¬í˜„ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
  constructor() {}

  // 3ï¸âƒ£ í”„ë¡œí¼í‹° 'í‚¤'ë“¤ì„ ì„ ì–¸ ìˆœì„œëŒ€ë¡œ í‰ê°€í•©ë‹ˆë‹¤.

  // 4ï¸âƒ£ ë©”ì„œë“œì™€ ì ‘ê·¼ìë¥¼ ì„ ì–¸ ìˆœì„œëŒ€ë¡œ installí•©ë‹ˆë‹¤.

  // <ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œ>ëŠ” prototypeì—,
  method1() {}

  // <private ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œ>ëŠ” ë‚˜ì¤‘ì— ì¸ìŠ¤í„´ìŠ¤ì— ì§ì ‘,
  #method2() {}

  // <static ë©”ì„œë“œ>ëŠ” í´ë˜ìŠ¤ ìì²´ì— installë©ë‹ˆë‹¤.
  static method3() {}

  // 5ï¸âƒ£ ì´ì œë¶€í„° í´ë˜ìŠ¤ Aì˜ ì´ë¦„ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  // ì´ì „ ë‹¨ê³„ì—ì„œ ì‚¬ìš©í•˜ë©´ ReferenceErrorê°€ ë°œìƒí•©ë‹ˆë‹¤.
  // âœï¸ ë§¨ ì•„ë˜ logged í•¨ìˆ˜ì˜ ì£¼ì„ì„ í•´ì œí•´ë³´ì„¸ìš”

  // 6ï¸âƒ£ í”„ë¡œí¼í‹° 'ê°’'ë“¤ì´ í‰ê°€ë©ë‹ˆë‹¤

  // <static í•„ë“œ>ì˜ 'ê°’'ì´ í‰ê°€ë  ë•Œ thisëŠ” í´ë˜ìŠ¤ ìì²´ì…ë‹ˆë‹¤.
  static [logged('key1')] = logged('val1');
  static [logged('key2')] = (() => {
    console.log(A === this);
    // ğŸ¤” ì™œ ì–´ë–¤ê±´ undefinedê³  ì–´ë–¤ê±´ ì•„ë‹Œì§€ ê³ ë¯¼í•´ë³´ì„¸ìš”
    console.log(A.key1, A.key3, A.method3);
    return 'val2';
  })();
  static {
    console.log('Static initialization blocks', this.key2, this.key3);
  }
  static [logged('key3')] = logged('val3');

  // <ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ>ì˜ 'ê°’'ë“¤ì€ ìƒì„±ì ì‹œì‘ ì „(base classì¸ ê²½ìš°) í˜¹ì€
  // superì˜ ë¦¬í„´ ì „(derived classì¸ ê²½ìš°)ì— ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
  // ìì„¸í•œê±´ ë‚˜ì¤‘ ì˜ˆì œì—ì„œ ë³¼ê²Œìš”
  [logged('key4')] = logged('val4');
}

// helper function
function logged(val) {
  // console.log(A);
  console.log(`log: ${val}`);
  return val;
}

// 7ï¸âƒ£ ë!
```

ì°¸ê³ ë¡œ, ìœ„ ì½”ë“œì—ì„œ ë“±ì¥í•œ **static initialization blocks**ì€ í´ë˜ìŠ¤ì˜ ìœ ì—°í•œ
ì´ˆê¸°í™”ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤:

```js
// @noexec
// âš ï¸
class A {
  static init() {
    //
    // Access to private static fields is allowed here
  }
}

// exposes an implementation detail to the user
A.init();

// âœ…
class B {
  static {
    // ...
  }
}
```

í´ë˜ìŠ¤ ì„ ì–¸ì—ì„œ í‚¤ëŠ” í•œ ë²ˆ, ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ ê°’ì€ ë§¤ë²ˆ í‰ê°€ë¨ì´ ì¸ìƒê¹Šì–´ì„œ ì•„ë˜
ì˜ˆì œë¥¼ ë§Œë“¤ì–´ë´¤ì–´ìš”:

```js
class A {
  [randomVal()] = randomVal();

  toString() {
    return JSON.stringify(this);
  }
}

// í‚¤ê°€ í•­ìƒ ê°™ìŠµë‹ˆë‹¤
console.log(new A(), new A(), new A());

// helper function
function randomVal() {
  return Math.floor(Math.random() * 10);
}
```

ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒì„± ê³¼ì • ì˜ˆì œì…ë‹ˆë‹¤:

```js
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/constructor

class A {
  x = logged(123);

  constructor() {
    // thisë¡œ ìƒì„±ì¤‘ì¸ ê°ì²´, new.targetìœ¼ë¡œ ìƒì„±ì í•¨ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    // í”„ë¡œí† íƒ€ì… ì²´ì¸ì´ ì—°ê²°ë˜ì–´ìˆê³  ìì‹ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë„ ë‹¤ ìˆê¸°ì—  String(this)ê°€ Bì…ë‹ˆë‹¤.
    // í´ë˜ìŠ¤ê°€ ì˜ ì„¤ê³„ë˜ì—ˆë‹¤ë©´ ë¶€ëª¨ìª½ì—ì„œ ìì‹ ìª½ ìƒì„±ìë¥¼ ê¶ê¸ˆí•´í•  ì´ìœ ê°€ ì—†ì§€ë§Œ
    // ë””ë²„ê¹…ë“±ë“±ì— ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤ë„¤ìš”.
    console.log(String(this), String(new.target));

    // í•˜ì§€ë§Œ ìì‹ í´ë˜ìŠ¤ì˜ í”„ë¡œí¼í‹°ëŠ” ì•„ì§ ì—†ìŠµë‹ˆë‹¤
    console.log(this.y);
  }

  static toString() {
    return 'class A';
  }

  toString() {
    return 'instance of A';
  }
}

class B extends A {
  y = logged(456);

  constructor() {
    // 1ï¸âƒ£ super ì´ì „ì˜ ìƒì„±ì ë³¸ë¬¸ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
    // ì•„ì§ì€ this ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
    console.log('Before super');

    // 2ï¸âƒ£ superê°€ í˜¸ì¶œë˜ì–´ ë¶€ëª¨ í´ë˜ìŠ¤ ë¶€ë¶„ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    // 3ï¸âƒ£ ì´í›„ í˜„ì¬ í´ë˜ìŠ¤ í•„ë“œë“¤ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
    super();

    // 4ï¸âƒ£ super ì´í›„ì˜ ìƒì„±ì ë³¸ë¬¸ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
    // ì´ì œ thisë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    console.log('After super');
    console.log(this.y);
  }

  static toString() {
    // ìƒì„±ìê°€ ì•„ë‹Œ ì¼ë°˜ ë©”ì„œë“œì—ëŠ” `super`ì— ëŒ€í•œ ì œì•½ì´ ì—†ìŠµë‹ˆë‹¤
    // ë¶€ëª¨ í´ë˜ìŠ¤ ë²„ì „ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ë„, í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.
    console.log(super.toString());
    return 'class B';
  }

  toString() {
    return 'instance of B';
  }
}

new B();

// helper function
function logged(val) {
  console.log(`log: ${val}`);
  return val;
}
```

ìƒì†ë³´ë‹¤ëŠ” ì»´í¬ì§€ì…˜(composition)ì„ ì„ í˜¸í•˜ë¼ëŠ” ë§ë„ ìˆìŠµë‹ˆë‹¤:

https://en.wikipedia.org/wiki/Composition_over_inheritance

JSê°€ abstract methodë‚˜ abstract classë¥¼ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ì§€ëŠ” ì•Šì§€ë§Œ ì•„ë˜ì™€ ê°™ì´
í‰ë‚´ëŠ” ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```js
// @noexec
class AbstractSet {
  has(x) {
    throw new Error('Abstract method');
  }
}
```

ì—¬ë‹´ìœ¼ë¡œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œ abstract classë¥¼ ë”°ë¡œ ì§€ì›í•©ë‹ˆë‹¤:

https://www.typescriptlang.org/docs/handbook/classes.html#abstract-classes

í”„ë¡œí† íƒ€ì… ê°ì²´ì™€ ìƒì„±ì í•¨ìˆ˜ì˜ ê´€ê³„ë¥¼ ì˜ ë³´ì—¬ì£¼ëŠ” ì±… ì›ë¬¸ìœ¼ë¡œ ì±•í„°ë¥¼
ë§ˆë¬´ë¦¬í• ê²Œìš”:

> Although the prototype object is the key feature of the class, the constructor
> function is the public identity of the class. @/components/ImageViewer
